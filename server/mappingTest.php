<?php
include('./library/connect.php');

$conn = connect();

// testdrawline(oneLatitude, oneLongitude, twoLatitude, twoLongitude)
// "id": num,
//             "source": {
//                 "latitude": "location of latitude",
//                 "longitude": "location of longitude"
//             },
//             "target": {
//                 "latitude": "location of latitude",
//                 "longitude": "location of longitude"
//             }
$sql = "SELECT * from testdrawline";
$data = mysqli_query($conn, $sql);

$item = array();
while ($row = mysqli_fetch_array($data)) {
    $elem = array();
    
    $source = array();
    $source['latitude'] = $row['oneLatitude'];
    $source['longitude'] = $row['oneLongitude'];
    
    $target = array();
    $target['latitude'] = $row['twoLatitude'];
    $target['longitude'] = $row['twoLongitude'];
    
    $elem['id'] = $row['id'];
    $elem['source'] = $source;
    $elem['target'] = $target;

    array_push($item, $elem);
}

disconnect($conn);
$result = array();
$result['result'] = 'success';
$result['item'] = $item;

$json = json_encode($result);
echo($json);


















function makeNew() {
$mapData = <<<test
35.15411810112818:129.03198601826105                     ;
35.147647433337234:129.03361348542074                    ;
35.147638609552295:129.03360229409773                    ;
35.145584687395235:129.03436306647336                    ;
35.14541427368613:129.0343149383792                      ;
35.14406087525595:129.03441290261827                     ;
35.14406087525595:129.03441290261827                     ;
35.14400815886128:129.03567328156464                     ;
35.14400815886128:129.03567328156464                     ;
35.144891693369175:129.03618625814906                    ;
35.14482875447338:129.03443476149295                     ;
35.14463611963791:129.0350388737566                      ;
35.14463621176366:129.0350333903943                      ;
35.14487104658973:129.0354040355333                      ;
35.14487086230337:129.03541500228687                     ;
35.145497776361715:129.0356473028606                     ;
35.145501865616296:129.03567209043888                    ;
35.14627857540703:129.0365088184072                      ;
35.14627388706102:129.03651967309466                     ;
35.146200518898155:129.03686344747868                    ;
35.14618034332429:129.03685745882214                     ;
35.14527822986811:129.03664571665527                     ;
35.14527822986811:129.03664571665527                     ;
35.14531133825896:129.03628448559135                     ;
35.14531119998303:129.03629271069633                     ;
35.144748304214936:129.036138800089                      ;
35.14401123959049:129.03441715259876                     ;
35.1437159162659:129.034160206243                        ;
35.143738251906086:129.03417173338732                    ;
35.143555975436335:129.03429336483828                    ;
35.14354678333345:129.03430410719494                     ;
35.143715078936246:129.0344783499326                     ;
35.143721374382245:129.0345059346332                     ;
35.14406110549577:129.03439919430357                     ;
35.14351304966702:129.03430052469582                     ;
35.1394692381587:129.0337528224467                       ;
35.14324125064732:129.03425261732917                     ;
35.14310346516555:129.03655311993253                     ;
35.14213495439954:129.03331997500482                     ;
35.14206783431819:129.03409724405262                     ;
35.14135402546045:129.03313598354714                     ;
35.141308229723535:129.03398508668099                    ;
35.142208490495065:129.03323403658408                    ;
35.14135393342799:129.0331414666958                      ;
35.141375809025305:129.03318040895084                    ;
35.13996166063673:129.0328709638284                      ;
35.139997232292515:129.03289927528348                    ;
35.1398696308363:129.03379021171807                      ;
35.14043133764741:129.03388098389942                     ;
35.14044768862667:129.03424891097868                     ;
35.14043436089541:129.03423760851808                     ;
35.142249870049994:129.0355993151375                     ;
35.143421434797105:129.03774044167795                    ;
35.14185311688629:129.03641773902567                     ;
35.1418527481565:129.03643967170925                      ;
35.14069580849913:129.03584036459148                     ;
35.140668784743106:129.03583969147112                    ;
35.14049352067021:129.03527581743504                     ;
35.14049857739009:129.03524303108566                     ;
35.139239144616596:129.03457537684955                    ;
35.139239144616596:129.03457537684955                    ;
35.13938357074657:129.03375617619793
test;

$split = explode(';', $mapData);
// echo(count($split));



$conn = connect();

// $aa = count($split);
echo(count($split));
for ($i = 0; $i < count($split); $i += 2){
    // echo $i."출력 <br />";
    $lat = explode(':', $split[$i])[0];
    $long = explode(':', $split[$i])[1];
    $lat = trim($lat);
    $long = trim($long);
    
    $oneLat = doubleval($lat);
    $oneLong = doubleval($long);
    
    $lat = explode(':', $split[$i + 1])[0];
    $long = explode(':', $split[$i + 1])[1];
    $lat = trim($lat);
    $long = trim($long);
    
    $twoLat = doubleval($lat);
    $twoLong = doubleval($long);

    $sql = "INSERT INTO testdrawline(oneLatitude, oneLongitude, twoLatitude, twoLongitude) values ('$oneLat', '$oneLong', '$twoLat', '$twoLong')";
    $result = mysqli_query($conn, $sql);
    
    if (!$result) {
        echo("fail");
    }
}


disconnect($conn);
   

}
?>
